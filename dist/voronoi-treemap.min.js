!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("d3-weighted-voronoi"),require("d3-voronoi-map"),require("d3-voronoi-treemap"),require("seedrandom")):"function"==typeof define&&define.amd?define(["exports","d3","d3-weighted-voronoi","d3-voronoi-map","d3-voronoi-treemap","seedrandom"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VoronoiTreemap={},t.d3,t.d3,t.d3,t.d3,t.seedrandom)}(this,function(t,e,a,n,r,i){"use strict";function o(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}}),e.default=t,Object.freeze(e)}var l=o(e),s=o(a),c=o(n),h=o(r),d=o(i);const p=Object.assign({},l,s,c,h);p.seedrandom=d.default||d;class u{constructor(t){this.d3=t||p}render(t,e=10,a=3,n){const r=this.d3.select(t).select("g.cell");if(r.empty())return;const i=this.d3.select(r.node().parentNode);i.select(".cell-outline").remove(),i.select(".cell-outline2").remove();const o=i.insert("g","g.cell + *").attr("class","cell-outline"),l=i.insert("g","g.cell + *").attr("class","cell-outline").attr("id","outline2");this._renderDepth2Outlines(r,l,n),this._renderDepth1Outlines(r,o,e,a)}_renderDepth2Outlines(t,e,a){const n=this;t.selectAll(".regionArea2").each(function(t){const r=n.d3.select(this),i=t.polygon,o=a?a(t.parent.color,0,-.2,-.15):n._defaultColorVar(t.parent.color,0,-.2,-.15);if(r.style("stroke",o),i&&i.length>0){const t="M"+i.map(t=>`${t[0]},${t[1]}`).join("L")+"Z",a=n.smoothPath(t,8,2);e.append("path").attr("d",`${t} ${a}`).attr("fill",o).attr("stroke",o).attr("stroke-width",0).style("fill-rule","evenodd")}})}_renderDepth1Outlines(t,e,a,n){const r=this;t.selectAll(".regionArea1").each(function(t){const i=t.polygon;if(i&&i.length>0){const t="M"+i.map(t=>`${t[0]},${t[1]}`).join("L")+"Z",o=r.smoothPath(t,a);e.append("path").attr("d",`${t} ${o}`).attr("fill","#555").attr("stroke","#555").attr("stroke-width",n).style("fill-rule","evenodd")}})}smoothPath(t,e=10,a=0){const n=t.replace(/[MZ]/gi,"").split("L").map(t=>t.trim().split(",").map(Number)).filter(([t,e])=>!isNaN(t)&&!isNaN(e));if(n.length<3)return t;let r=this._simplifyPoints(n,a);if(r.length<3)return t;const i=r.length;let o="";for(let t=0;t<i;t++){const a=r[(t-1+i)%i],n=r[t],l=r[(t+1)%i],s={x:a[0]-n[0],y:a[1]-n[1]},c={x:l[0]-n[0],y:l[1]-n[1]},h=Math.hypot(s.x,s.y),d=Math.hypot(c.x,c.y);if(h<1e-7||d<1e-7)continue;const p={x:s.x/h,y:s.y/h},u={x:c.x/d,y:c.y/d},f=p.x*u.x+p.y*u.y;let g=Math.acos(Math.max(-1,Math.min(1,f)));const m=g<Math.PI/4.5?e/2:e,y=g/2,b=Math.min(h,d)/2.1,x=Math.min(h,d,m/Math.tan(y),b/Math.tan(y)),v=[n[0]+p.x*x,n[1]+p.y*x],L=[n[0]+u.x*x,n[1]+u.y*x];o+=0===t?`M${v[0]},${v[1]}`:` L${v[0]},${v[1]}`,o+=` Q${n[0]},${n[1]} ${L[0]},${L[1]}`}return o+="Z",o}_simplifyPoints(t,e){if(e<=0||t.length<=3)return t;const a=[t[0]];let n=t[0];for(let r=1;r<t.length;r++){const i=t[r];Math.hypot(i[0]-n[0],i[1]-n[1])>=e&&(a.push(i),n=i)}const r=a[0],i=a[a.length-1];if(i!==r){Math.hypot(r[0]-i[0],r[1]-i[1])<e&&a.pop()}return a.length>=3?a:t}_defaultColorVar(t,e=0,a=0,n=0){let r=this.d3.hsl(t);return r.h+=e,r.l+=a,r.s+=n,r.l>.95&&(r.l=.95),r.formatHex()}}class f{constructor(t){this.d3=t||p}adjust(t,e={}){const{verticalSpacing:a=0,delay:n=100}=e,r=this.d3;function i(t,e){const n=a/2;return!(t.x+t.width/2+-3<e.x-e.width/2||t.x-t.width/2- -3>e.x+e.width/2||t.y+t.height/2+n<e.y-e.height/2||t.y-t.height/2-n>e.y+e.height/2)}function o(t){const e=t.node();if(!e)return null;const a=e.getBBox();let{width:n,height:r}=a;const i=t.selectAll("tspan tspan").size()||1,o=function(t){if(!t)return{x:0,y:0};const e=t.match(/translate\(([^,]+),([^)]+)\)/);return e?{x:parseFloat(e[1]),y:parseFloat(e[2])}:{x:0,y:0}}(t.attr("transform"));return{originalX:o.x,originalY:o.y,x:o.x+n/2,y:o.y+r/2,width:n,height:r,tspanCount:i}}function l(t){if(!t||!t.polygon)return null;const e=t.polygon.map(t=>t[0]),a=t.polygon.map(t=>t[1]);return{minX:Math.min(...e),maxX:Math.max(...e),minY:Math.min(...a),maxY:Math.max(...a)}}function s(t,e,n){if(t.x+t.width/2<e.x-e.width/2||t.x-t.width/2>e.x+e.width/2)return{x:t.originalX,y:t.originalY};if(0===function(t,e){const n=a/2,r=t.y-t.height/2-n,i=t.y+t.height/2+n,o=e.y-e.height/2-n,l=e.y+e.height/2+n;return i<=o||r>=l?0:t.y<e.y?i-o:l-r}(t,e))return{x:t.originalX,y:t.originalY};const r=t.y<e.y;let i=t.y;if(r){const a=e.originalY-t.height+(t.tspanCount>1?t.height/(t.tspanCount-1)/4:0);a>=n.minY&&(i=a)}else{const a=e.originalY+e.height+(t.tspanCount>1?t.height/(t.tspanCount-1)/4:0);a+t.height<=n.maxY&&(i=a)}return{x:t.originalX,y:i}}setTimeout(()=>{const e=r.select(t);e.selectAll(".field").each(function(){!function(e){const a=e.datum();if(!a||!a.parent)return;const n=r.select(t).selectAll(".region").filter(t=>t?.data?.key===a.parent?.data?.key).nodes()[0];if(!n)return;const c=r.select(n),h=o(e),d=o(c),p=l(a);if(!p||!h||!d||0===h.width||0===h.height||0===d.width||0===d.height)return;const u=c.datum()?.data?.key;if(u&&String(u).match(/[^ ]/)&&i(h,d)){const t=s(h,d,p);e.attr("transform",`translate(${t.x},${t.y})`)}}(r.select(this))}),e.selectAll(".sector").each(function(){!function(e){const a=e.datum();if(!a||!a.parent)return;const n=r.select(t).selectAll(".field").filter(t=>t?.data?.key===a.parent?.data?.key).nodes()[0];if(!n)return;const c=r.select(n),h=o(e),d=o(c),p=l(a);if(!p||!h||!d||0===h.width||0===h.height||0===d.width||0===d.height)return;if(i(h,d)){const t=s(h,d,p);e.attr("transform",`translate(${t.x},${t.y})`)}}(r.select(this))})},n)}}function g(t,e="bigClusterLabel",a="clusterLabel"){const n=t.map(t=>({[e]:t[e],[a]:t[a],region:t.region,budget:t.bubbleSize??1})),r=p.rollups(n,t=>p.sum(t.map(t=>t.budget)),t=>t.region,t=>t[e],t=>t[a]),i=(n,r,i)=>r.map(r=>{const o={[e]:n,[a]:r[0],budget:r[1]?r[1]:1},l=t.filter(t=>t.region===i&&t[e]===o[e]&&t[a]===o[a]);return{key:r[0],values:[o],data:l[0],raw:l}});return{key:"root_nest",values:r.map(([t,e])=>({key:t,values:e.map(([e,a])=>({key:e,values:i(e,a,t)}))})).filter(t=>t.key)}}const m={fontScale:function(t,e){let a=e.value/t.value*100;return a>30&&(a=30),a<.2&&(a=.2),p.scaleLog().domain([.1,20]).range([.3,1.5])(a)},fontScale1:function(t,e,a){let n=a/t.value*100;return n>30&&(n=30),n<.2&&(n=.2),p.scaleLog().domain([.1,20]).range([.3,1.5])(n)},fontScale2:function(t,e){let a=e.value/t.value*100;return a>5&&(a=5),a<.1&&(a=.1),p.scaleLog().domain([.1,8]).range([.5,.8])(a)},varFontScale:function(t,e){const a=e.data.data.clusterLabel??e.data.data.bigClusterLabel,[n,r]=this.multiline(a,!0);return e.data.data.clusterLabel?6*this.fontScale2(t.hierarchy,e)*r/2+20:30*this.fontScale(t.hierarchy,e)*r/2+8},getHSLColor:function(t,e,a,n){e=e||0,a=a||0,n=n||0;const r=p.hsl(t);return r.copy({h:r.h+e,s:r.s+a,l:r.l+n}).formatHex()},colorVar:function(t,e,a,n){e=e||0,a=a||0,n=n||0;let r=p.hsl(t);return r.h+=e,r.l+=a,r.s+=n,r.l>.95&&(r.l=.95),r.formatHex()},colorVar2:function(t){let e=p.hsl(t);return e.l=.3*e.l,e.s=.25,e.l>.95&&(e.l=.95),e.l<.1&&(e.l=.1),e.formatHex()},colorvariation:function(t,e,a,n){const r=p.extent(e);let i=p.scaleLinear().domain(r).range([.3,1]),o=p.hsl(t);return o.l>.8&&(o.l=.8),o.l+=.1*(.5-i(a)),o.l>.9&&(o.l=.9),o.formatHex()},colorHierarchy:function(t,e){if(0===e.depth)e.color="#ddd";else if(1===e.depth)e.color=t.regionColor(e.data.key);else if(2===e.depth)e.color=this.colorvariation(e.parent.color,e.parent.children.map(t=>t.value),e.value,e.depth+e.data.key);else if(3===e.depth&&(e.color=this.colorvariation(e.parent.color,e.parent.parent.children.map(t=>t.value),e.value,e.depth+e.data.key),t.params.colorFunc)){const a=t.data.filter(t=>t.clusterLabel===e.data.key&&t.bigClusterLabel===e.parent.data.key);e.color=t.params.colorFunc(a,e.data.data,e.color,{parentColor:e.parent.color,siblings:e.parent.parent.children.map(t=>t.value),value:e.value,depth:e.depth,region:e.parent.parent})}e.children&&e.children.forEach(e=>this.colorHierarchy(t,e))},multiline:function(t,e){const a=t?String(t):"",n=!/[^A-Za-z0-9\s\-.,!?:;@]/.test(a),r=a.split("\n");let i=[];r.forEach(t=>{const e=t.split(/[ ,]/);let a=[],r=0,o=0;a[0]="",e.forEach(t=>{t.length+r>(n?9:7)&&(o+=1,r=0,a[o]=""),a[o]=a[o]+t.trim()+" ",r+=t.length});const l=a.filter(t=>t.trim());i=i.concat(l)});const o={i:.4,j:.4,l:.4,t:.5,f:.5,r:.6,I:.3,1:.6,"!":.3,"|":.3,".":.3,",":.3,":":.3,";":.4,w:1.4,W:1.6,m:1.3,M:1.5,"@":1.4,a:.9,e:.9,o:.9,u:.9,n:.9,s:.8,A:1.1,E:1,O:1.2,U:1.1,N:1.1,S:1};const l=i.map(t=>{const e=t.trim();return!/[^A-Za-z0-9\s\-.,!?:;@]/.test(e)?function(t){return Array.from(t).reduce((t,e)=>t+(o[e]||1),0)}(e):e.length});let s=Math.max(...l);if(e)return[s,i.length];const c=i.map((t,e)=>`<tspan x=${-s/3}em dy=1em>${t.trim()}</tspan>`).join("");return`<tspan x=0em y=${-i.length/2}em>${c}</tspan>`},getLabelHeightOffset:function(t,e){const a=this.fontScale(t.hierarchy,e),[n,r]=this.multiline(e.data.key,!0);return 8*a*(r-2)},getLabelPos:function(t,e){if(1===e.depth)return;const a=e.parent.polygon.site,n=e.polygon.site;if(e.parent.children.length>1)return[n.x,n.y];const r=n.x-a.x,i=n.y-a.y;let o=0,l=0;const s=this.fontScale2(t.hierarchy,e),[c,h]=this.multiline(e.data.key,!0),d=6*s*h,p=6*s*c,u=Math.max(18,d/2);Math.abs(i)<u&&(o=i>=0?u:-u,Math.abs(r)<p&&(l=r>=0?p/2:-p/2));const f=this.getPolygonBounds(e.parent.polygon),g=n.x+l,m=n.y+o;return g<f.minX+p/2?l=f.minX+p/2-n.x:g>f.maxX-p/2&&(l=f.maxX-p/2-n.x),m<f.minY+d/2?o=f.minY+d/2-n.y:m>f.maxY-d/2&&(o=f.maxY-d/2-n.y),[n.x+l,n.y+o]},getPolygonBounds:function(t){const e=t.map(t=>t[0]),a=t.map(t=>t[1]);return{minX:Math.min(...e),maxX:Math.max(...e),minY:Math.min(...a),maxY:Math.max(...a)}},estimatePolygonRadius:function(t){const e=t.polygon.site.originalObject.polygon.area();return Math.sqrt(e/Math.PI)},estimateLabelWidth:function(t,e,a){a=a||1;const n=this.fontScale(t.hierarchy,e)*a,[r,i]=this.multiline(e.data.key,!0);return Math.max(16*n*r*.8,60)},estimateLabelHeight:function(t,e,a){a=a||1;const n=this.fontScale(t.hierarchy,e)*a,[r,i]=this.multiline(e.data.key,!0);return Math.max(16*n*i*1.5,40)},createLabelContext:function(t,e,a){return{key:e.data.key,value:e.value,depth:e.depth,data:e.data.values[0]?.data,ratio:e.value/t.totalValue,percentText:p.format(".0%")(e.value/t.totalValue),color:e.color,parentColor:e.parent?.color,darkerColor:this.getHSLColor(e.color,0,-.1,-.2),lighterColor:this.getHSLColor(e.color,0,.1,.1),fontSize:1===a?1.15*this.fontScale(t.hierarchy,e):this.fontScale(t.hierarchy,e),centerX:e.polygon.site.x,centerY:e.polygon.site.y,polygon:e.polygon,parent:e.parent?{key:e.parent.data.key,value:e.parent.value,color:e.parent.color}:null,children:e.children?e.children.map(t=>({key:t.data.key,value:t.value,color:t.color})):null,totalValue:t.totalValue,formatNumber:t=>this.bigFormat(t),formatPercent:t=>p.format(".1%")(t)}},bigFormat:function(t){const e=t>10**12?Math.floor(t/10**12)%1e4:0,a=t>10**8?Math.round(t/10**8)%1e4:0,n=parseInt(t/1e4)%1e4;return(e>=1?p.format(",.0f")(e)+"조 ":" ")+(a>=1?p.format(",.0f")(a)+"억 ":" ")+(t<10**10&&n>=1?p.format(",.0f")(n)+"만 ":" ")+(t<1e4?p.format(",.0f")(Math.round(t)):" ")},createCustomVoronoiAlgorithm:function(t,e){e=e||!1;const a=Math.random;var n=[[0,0],[0,1],[1,1],[1,0]],r=[[0,0],[1,1]],i=[1,1],o=.01,l=50,s=.01,c=a,h={},d=p.voronoiMapSimulation([{weight:1},{weight:1}]).stop();const u=this,f=function(t){g(n,t)};f.convergenceRatio=function(t){return arguments.length?(o=t,f):o},f.maxIterationCount=function(t){return arguments.length?(l=t,f):l},f.minWeightRatio=function(t){return arguments.length?(s=t,f):s},f.clip=function(t){return arguments.length?(d.clip(t),n=d.clip(),r=d.extent(),i=d.size(),f):n},f.extent=function(t){return arguments.length?(d.extent(t),n=d.clip(),r=d.extent(),i=d.size(),f):r},f.size=function(t){return arguments.length?(d.size(t),n=d.clip(),r=d.extent(),i=d.size(),f):i},f.prng=function(t){return arguments.length?(c=t,f):c},f.initialPositions=function(t){return arguments.length?(h=t,f):h};const g=function(a,n){var r;if(n.polygon=a,0!=n.height){for(var i=(r=p.voronoiMapSimulation(n.children).clip(a).weight(t=>t.value).convergenceRatio(o).maxIterationCount(l).minWeightRatio(s).prng(c).initialPosition(u.createInitialPositioner(t,h,e)).stop()).state();!i.ended;)r.tick(),i=r.state();i.polygons.forEach(function(t){g(t,t.site.originalObject.data.originalData)})}};return f},createInitialPositioner:function(t,e,a){var n,r,i,o,l,s,c,h;function d(t,e){return e.find(e=>e.depth===t.depth&&e.key===t.data.key)}return function(a,u,f,g){var m=!1;if(n!==g.clip()&&(n=g.clip(),r=g.extent(),m=!0),m&&(i=r[0][0],o=r[1][0],l=r[0][1],s=r[1][1],c=o-i,h=s-l),0===a.depth)return[(i+o)/2,(l+s)/2];const y=a.parent||f[0].parent,b=function(t,e){return t.map(t=>d(t,e)).filter(t=>void 0!==t)}(y?y.children:f,e);if(b.length>0){const r=p.extent(b,t=>t.x),i=p.extent(b,t=>t.y),o=d(a,e);if(o){const e=o.x*t.width,a=o.y*t.height;if(p.polygonContains(n,[e,a]))return[e,a];const[l,s]=function(t,e,a,n){const r=Math.atan2(e,t),i=r<0?r+2*Math.PI:r;let o,l,s,c;for(let t=0;t<a.length;t++)if(i<=a[t].angle){o=0===t?a[a.length-1].angle:a[t-1].angle,l=a[t].angle,s=0===t?a[a.length-1]:a[t-1],c=a[t];break}void 0===o&&(o=a[a.length-1].angle,l=a[0].angle+2*Math.PI,s=a[a.length-1],c=a[0]);const h=(i-o)/(l-o),d=s.x+h*(c.x-s.x),u=s.y+h*(c.y-s.y),f=Math.sqrt(t*t+e*e)/Math.sqrt(2)*.9,g=f*d,m=f*u,y=p.extent(n,t=>t[0]),b=p.extent(n,t=>t[1]);return[p.scaleLinear().domain([-1,1]).range(y)(g),p.scaleLinear().domain([-1,1]).range(b)(m),i,f,[t,e]]}(p.scaleLinear().domain(r).range([-1,1])(o.x),p.scaleLinear().domain(i).range([-1,1])(o.y),function(t){const e=p.extent(t,t=>t[0]),a=p.extent(t,t=>t[1]);return t.map(t=>{const n=p.scaleLinear().domain(e).range([-1,1])(t[0]),r=p.scaleLinear().domain(a).range([-1,1])(t[1]),i=Math.atan2(r,n);return{angle:i<0?i+2*Math.PI:i,point:t,x:n,y:r}}).sort((t,e)=>t.angle-e.angle)}(n),n);return[l,s]}}let x,v;do{x=i+c*g.prng()(),v=l+h*g.prng()()}while(!p.polygonContains(n,[x,v]));return[x,v]}}};function y(t){return t?t.replace(/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~\n\r\t]/g,"\\$&"):""}class b{constructor(){this.margin={top:50,right:50,bottom:50,left:50},this.svg=null,this.data=null,this.hierarchy=null,this.allNodes=null,this._pebbleRenderer=null,this._labelAdjuster=null}static get DEFAULT_COLORS(){return"#afc7dd,#ffe9a9,#f69f8f,#b4c8af,#e9e4d6,#bed1d8,#f8dba1,#fcbc8b,#d7e0c4,#c5b5a6,#b5ccc1,#e9bfb4,#e9f0f6,#fffefb,#fce0db,#e1e9df,#f1f5f7,#fef8ed,#feeada,#fbfcf9,#e5ded7,#e5edea,#fbf5f3,#96b6d3,#ffdf85,#f3836e,#a0b99a,#ddd4be,#a7c1cb,#f5cf80,#fba868,#c7d4ac,#b7a490,#a0bdb0,#e1a799,#d7e3ee,#fff7e1,#facbc3,#d3dfd0,#fdfcfa,#e1eaed,#fcefd5,#fddcc2,#f0f3e9,#dbd2c8,#d6e3dd,#f6e4df,#dee8f1,#fffaeb,#fbd4cc,#d9e3d6,#e7eef1,#fcf3df,#fee1cc,#f4f7ef,#dfd7ce,#dce7e2,#f8ebe7,#e5edf4,#fffdf5,#fcdcd6,#dfe7dc,#eef3f5,#fdf6e8,#fee7d6,#f9faf6,#e3dcd4,#e2ebe7,#faf1ef,#d0b7ba,#b8cec4,#d2b6b6,#b6bdd6,#d9b8b7,#ded5b6,#bac2d7,#c8d5be,#e3bfb7,#f9dfb3,#eac2b8,#c1d3da,#ddc7c1,#d9e2c7,#cfdad5,#eecdc1,#ccdddf,#c7d7e6,#ded6cf,#e7d1cb,#ced9e5,#eedbc8,#d7e3e2,#e3ead2,#ecdcd2,#d9e0e5,#efe1d2,#ebdad7,#eed6da,#e1e6de,#dde4e8,#eee1d8,#f5e8d7,#f1e6dd,#f5e8de,#f3e7e1,#f5eee1,#f5f2ec".split(",")}static get DEFAULT_OPTIONS(){return{width:500,height:300,maptitle:"",caption:"",clickFunc:()=>{},colorFunc:null,sizeLimit:1e3,ratioLimit:0,pieSize:1,colors:b.DEFAULT_COLORS,seedRandom:10,showRegion:!1,showPercent:!1,underLabel:!1,regionPositions:null,forceNodeFunc:null,debug:!1,pebbleRound:25,pebbleWidth:3,regionColors:[],regionLabelRenderer:null,bigClusterLabelRenderer:null}}get pebbleRenderer(){return this._pebbleRenderer||(this._pebbleRenderer=new u(p)),this._pebbleRenderer}get labelAdjuster(){return this._labelAdjuster||(this._labelAdjuster=new f(p)),this._labelAdjuster}render(t,e={}){return this.params={...b.DEFAULT_OPTIONS,...e},this.data=t,this._setupSVG(),this._prepareData(),this._setupGroups(),this._drawTitleAndCaption(),this._createRegionColorScale(),this._computeLayout(),this._drawCells(),this._drawLabels(),this._applyPostEffects(),this.svg.node()}update(t){return this.render(t,this.params)}_setupSVG(){this.svg=p.create("svg").attr("width",this.params.width+this.margin.left+this.margin.right).attr("height",this.params.height+this.margin.top+this.margin.bottom),this.svg.append("rect").attr("width","100%").attr("height","100%").style("fill","#fff"),this.width=this.params.width*Math.sqrt(this.params.pieSize),this.height=this.width*(this.params.height/this.params.width)}_prepareData(){const t=g(this.data,"bigClusterLabel","clusterLabel");this.hierarchy=p.hierarchy(t,t=>t.values).sum(t=>t.budget),this.totalValue=this.hierarchy.value}_setupGroups(){this.chartGroup=this.svg.append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`),this.voronoiGroup=this.chartGroup.append("g").attr("class","cell"),this.labelsGroup=this.chartGroup.append("g").attr("class","labels"),this.popLabelsGroup=this.chartGroup.append("g").attr("class","pop"),this.bigLabelsGroup=this.chartGroup.append("g").attr("class","label1"),this.percentLabelsGroup=this.chartGroup.append("g").attr("class","percent"),this.regionLabelsGroup=this.chartGroup.append("g").attr("class","region")}_drawTitleAndCaption(){this.svg.append("g").append("text").attr("class","title").attr("text-anchor","middle").attr("font-size","22").attr("font-weight","600").attr("transform",`translate(${this.margin.left+this.width/2},${this.margin.top-15})`).html(this.params.maptitle),this.svg.append("g").append("text").attr("class","caption").attr("text-anchor","middle").attr("font-size","15").attr("font-weight","400").attr("fill","#888").attr("transform",`translate(${this.margin.left+this.width/2},${this.margin.top+this.height+30})`).html(this.params.caption)}_createRegionColorScale(){const t=Array.from(new Set(this.data.map(t=>t.region))),{regionColors:e,colors:a}=this.params,n=e.map(t=>t.key),r=e.map(t=>t.color);let i={};t.forEach((t,e)=>{i[t]=a[e%a.length]}),n.forEach((t,e)=>{i[t]=r[e]}),this.regionColor=p.scaleOrdinal().domain(Object.keys(i)).range(Object.values(i))}_computeLayout(){const t=p.range(100).map(t=>{let e=Math.cos(t/50*Math.PI);const a=.92;e>a&&(e=a+.5*(e-a)),e<-a&&(e=.5*(e+a)-a),e/=.94;const n=Math.sin(t/25*Math.PI);return[this.width*(1+.99*e)/2,this.height*(1+.99*n)/2]}),e=new Math.seedrandom(this.params.seedRandom);if(p.voronoiTreemap().prng(e).clip(t)(this.hierarchy),this.params.regionPositions&&"auto"!==this.params.regionPositions){const a=this._normalizePositions(this.params.regionPositions);m.createCustomVoronoiAlgorithm(this,this.params.debug).size([this.width,this.height]).clip(t).prng(e).initialPositions(a)(this.hierarchy)}m.colorHierarchy(this,this.hierarchy),this.allNodes=this.hierarchy.descendants().sort((t,e)=>e.depth-t.depth).map((t,e)=>Object.assign({},t,{id:e}))}_normalizePositions(t){const e=[],a=this.hierarchy.descendants(),n=t.filter(t=>1===t.depth);if(n.length>0){const t=p.extent(n,t=>t.x),a=p.extent(n,t=>t.y),r=t[0]===t[1]?()=>.5:p.scaleLinear().domain(t).range([.15,.85]),i=a[0]===a[1]?()=>.5:p.scaleLinear().domain(a).range([.15,.85]);n.forEach(t=>{e.push({...t,x:r(t.x),y:i(t.y)})})}return[2,3].forEach(n=>{const r=t.filter(t=>t.depth===n);if(0===r.length)return;const i=a.filter(t=>t.depth===n);p.group(i,t=>t.parent?.data?.key).forEach((t,a)=>{const n=new Set(t.map(t=>t.data.key)),i=r.filter(t=>n.has(t.key));if(0===i.length)return;const o=p.extent(i,t=>t.x),l=p.extent(i,t=>t.y),s=o[0]===o[1]?()=>.5:p.scaleLinear().domain(o).range([.15,.85]),c=l[0]===l[1]?()=>.5:p.scaleLinear().domain(l).range([.15,.85]);i.forEach(t=>{e.push({...t,x:s(t.x),y:c(t.y)})})})}),e}_drawCells(){const{clickFunc:t}=this.params,e=this;this.voronoiGroup.selectAll("path").data(this.allNodes).enter().append("path").attr("d",t=>"M"+t.polygon.join("L")+"Z").style("fill",t=>t.color??t.parent.color).attr("class",t=>`regionArea${t.depth} area-${t.id}`).style("fill-opacity",t=>3===t.depth?1:0).attr("pointer-events",t=>3===t.depth?"all":"none").on("click",function(a,n){let r=e.voronoiGroup.select(`.area-${n.id}`);const i=r.attr("class").match("clicked");e.voronoiGroup.select(".clicked").classed("clicked",!1),r.classed("clicked",!i),t(i?"":{...n.data,event:a,d:n,clickArea:r})}).on("mouseenter",function(t,a){e.bigLabelsGroup.select(`[data-bigCluster="${y(a.data.data.bigClusterLabel)}"]`).attr("opacity",1);e.labelsGroup.select(`[data-cluster="${y(a.data.data.clusterLabel)}"]`).attr("opacity",1),e.voronoiGroup.select(`.area-${a.id}`).classed("highlite",!0)}).on("mouseleave",function(t,a){const n=e.bigLabelsGroup.select(`[data-bigCluster="${y(a.data.data.bigClusterLabel)}"]`);n.attr("opacity",t=>n.attr("data-ratio")>=e.params.ratioLimit?1:0);const r=e.labelsGroup.select(`[data-cluster="${y(a.data.data.clusterLabel)}"]`);r.attr("opacity",t=>r.attr("data-ratio")>=e.params.ratioLimit?1:0),e.voronoiGroup.select(`.area-${a.id}`).classed("highlite",!1)})}_drawLabels(){this._drawRegionLabels(),this._drawBigClusterLabels(),this._drawPercentLabels(),this._drawSectorLabels(),this._drawPopLabels()}_drawRegionLabels(){const{showRegion:t,regionLabelRenderer:e}=this.params,a=this.allNodes.filter(t=>1===t.depth);e?this.regionLabelsGroup.selectAll("foreignObject").data(a).enter().append("foreignObject").attr("class","region-label-foreign").attr("data-region",t=>t.data.key).attr("width",t=>{const e=m.getPolygonBounds(t.polygon);return.6*(e.maxX-e.minX)}).attr("height",t=>m.estimateLabelHeight(this,t,1.3)).attr("x",t=>{const e=m.getPolygonBounds(t.polygon),a=e.maxX-e.minX;return t.polygon.site.x-.6*a/2}).attr("y",t=>t.polygon.site.y-.4*m.estimateLabelHeight(this,t,1.3)+m.getLabelHeightOffset(this,t)).style("opacity",t?1:0).style("pointer-events","none").style("overflow","visible").append("xhtml:div").style("width","100%").style("height","100%").style("display","flex").style("align-items","center").style("justify-content","center").html(t=>{const a=m.multiline(t.data.key),n=m.createLabelContext(this,t,1);return e(t,a,n)}):this.regionLabelsGroup.selectAll("text").data(a).enter().append("text").attr("class","region").attr("text-anchor","start").attr("ratio",t=>t.value/t.parent.value).style("font-size",t=>1.15*m.fontScale(this.hierarchy,t)+"em").style("fill-opacity",t?1:0).style("stroke-opacity",t?.85:0).style("stroke",t=>`${m.getHSLColor(t.color,0,-.05,-.2)}`).attr("paint-order","stroke").attr("transform",t=>`translate(${[t.polygon.site.x,t.polygon.site.y+m.getLabelHeightOffset(this,t)]})`).html(t=>m.multiline(t.data.key))}_drawBigClusterLabels(){const{ratioLimit:t,bigClusterLabelRenderer:e}=this.params,a=this.allNodes.filter(t=>2===t.depth);e?this.bigLabelsGroup.selectAll("foreignObject").data(a).enter().append("foreignObject").attr("class","bigcluster-label-foreign").attr("data-bigCluster",t=>t.data.key).attr("data-value",t=>t.value).attr("data-ratio",t=>t.value/this.totalValue).attr("width",t=>{const e=m.getPolygonBounds(t.polygon);return.6*(e.maxX-e.minX)}).attr("height",t=>m.estimateLabelHeight(this,t,1.2)).attr("x",t=>{const e=m.getPolygonBounds(t.polygon),a=e.maxX-e.minX;return t.polygon.site.x-.6*a/2}).attr("y",t=>t.polygon.site.y-.45*m.estimateLabelHeight(this,t,1.2)+m.getLabelHeightOffset(this,t)).attr("opacity",e=>e.value/this.totalValue>=t?1:0).style("pointer-events","none").style("overflow","visible").append("xhtml:div").style("width","100%").style("height","100%").style("display","flex").style("align-items","center").style("justify-content","center").html(t=>{const a=m.multiline(t.data.key),n=m.createLabelContext(this,t,2);return e(t,a,n)}):this.bigLabelsGroup.selectAll("text").data(a).enter().append("text").attr("class","field").attr("data-bigCluster",t=>t.data.key).attr("text-anchor","start").attr("data-value",t=>t.value).attr("data-ratio",t=>t.value/this.totalValue).style("font-size",t=>m.fontScale(this.hierarchy,t)+"em").attr("paint-order","stroke").style("fill",t=>m.colorVar2(t.parent.color,0,.2,-.2)).attr("transform",t=>`translate(${[t.polygon.site.x,t.polygon.site.y+m.getLabelHeightOffset(this,t)]})`).html(t=>m.multiline(t.data.key)).attr("opacity",e=>e.value/this.totalValue>=t?1:0)}_drawPercentLabels(){const{showPercent:t}=this.params,e=this.allNodes.filter(t=>1===t.depth).length>1?1:2;this.percentLabelsGroup.selectAll("text").data(this.allNodes.filter(t=>t.depth===e)).enter().append("text").attr("class",t=>`budget percent label-${t.id}`).attr("text-anchor","middle").style("font-size",t=>.8*m.fontScale(this.hierarchy,t)+"em").attr("transform",t=>`translate(${[t.polygon.site.x,t.polygon.site.y+8*m.fontScale(this.hierarchy,t)*(m.multiline(t.data.key,!0)[1]+2.2)]})`).text(t=>" "+p.format(".0%")(t.value/this.totalValue)).attr("opacity",e=>t&&Math.round(e.value/this.totalValue*100)>0?1:0)}_drawSectorLabels(){const{underLabel:t,ratioLimit:e}=this.params;this.labelsGroup.selectAll("text").data(this.allNodes.filter(t=>3===t.depth)).enter().append("text").attr("class",t=>`sector label-${t.id}`).attr("data-cluster",t=>t.data.key).attr("data-value",t=>t.value).attr("data-ratio",t=>t.value/this.totalValue).attr("text-anchor","start").style("font-size",t=>m.fontScale2(this.hierarchy,t)+"em").style("fill",t=>m.getHSLColor(t.color,0,-.1,-.3)).attr("transform",e=>t?`translate(${[e.polygon.site.x,e.polygon.site.y+8*m.fontScale1(this.hierarchy,e.data.data.bigClusterLabel,e.parent.value)*(m.multiline(e.data.data.bigClusterLabel,!0)[1]+.5)]})`:`translate(${m.getLabelPos(this,e)})`).html(t=>m.multiline(t.data.key)).attr("opacity",t=>t.value/this.totalValue>e?1:0)}_drawPopLabels(){const{sizeLimit:t}=this.params;this.popLabelsGroup.selectAll("text").data(this.allNodes.filter(t=>3===t.depth)).enter().append("text").attr("class",t=>`budget label-${t.id}`).attr("text-anchor","middle").style("font-size",t=>.8*m.fontScale2(this.hierarchy,t)+"em").attr("data-pop",t=>t.data.data.clusterLabel??t.data.data.bigClusterLabel).attr("transform",t=>`translate(${[t.polygon.site.x,t.polygon.site.y+m.varFontScale(this,t)]})`).text(t=>m.bigFormat(t.data.values[0].budget)).attr("opacity",e=>e.value>t?1:0)}_applyPostEffects(){const{showRegion:t,pebbleRound:e,pebbleWidth:a}=this.params;t&&this.labelAdjuster.adjust(this.svg.node(),{verticalSpacing:0}),this.pebbleRenderer.render(this.svg.node(),e,a,m.colorVar.bind(m))}}function x(t){const e=document.querySelector(".voronoi-popup-content");if(e&&e.remove(),!t)return null;const a=t.event,n=t.data||{},r=document.createElement("div");r.className="voronoi-popup-content";const i=a.pageX,o=a.pageY;r.style.left=i+"px",r.style.top=o+"px";const l=document.createElement("div");return l.className="voronoi-popup-message",l.innerHTML=`\n    <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 0.5em;">\n      ${n.bigClusterLabel||"N/A"}\n    </div>\n    <div style="margin-bottom: 0.3em;">\n      <strong>Region:</strong> ${n.region||"N/A"}\n    </div>\n    <div>\n      <strong>Size:</strong> ${n.bubbleSize||"N/A"}\n    </div>\n  `,r.appendChild(l),document.body.appendChild(r),setTimeout(()=>{const t=e=>{r.contains(e.target)||(r.remove(),document.removeEventListener("click",t))};document.addEventListener("click",t)},0),r}t.LabelAdjuster=f,t.PebbleRenderer=u,t.VoronoiTreemap=b,t.VoronoiTreemapHelpers=m,t.createDOMPopup=x,t.default=b,t.getPopupStyles=function(){return'\n.voronoi-popup-content {\n  position: absolute;\n  background: #fffe;\n  border: 2px solid #555;\n  border-radius: 30px;\n  padding: 10px;\n  z-index: 1000000;\n  transform: translateX(-50%) translateY(-100%);\n  min-width: 100px;\n}\n\n.voronoi-popup-content::before {\n  content: " ";\n  position: absolute;\n  top: 100%;\n  left: 50%;\n  margin-left: -10px;\n  border-width: 10px;\n  border-style: solid;\n  border-color: #555 transparent transparent transparent;\n}\n\n.voronoi-popup-content::after {\n  content: " ";\n  position: absolute;\n  top: 100%;\n  left: 50%;\n  margin-left: -8px;\n  border-width: 8px;\n  border-style: solid;\n  border-color: #fff transparent transparent transparent;\n}\n\n.voronoi-popup-message {\n  max-width: 350px;\n  min-width: 200px;\n  padding: 1em;\n  line-height: 1.5;\n  color: #444;\n  text-align: left;\n  max-height: 400px;\n  overflow-y: scroll;\n  overflow-x: clip;\n}\n'},t.nestingForVoronoi=g,t.showVoronoiPopup=function(t){if(!t)return null;const e=t.data||{};return"undefined"!=typeof html?html`<div style="
      background: #fffe;
      border: 2px solid #555;
      border-radius: 15px;
      padding: 15px;
      max-width: 350px;
      min-width: 200px;
    ">
      <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 0.5em;">
        ${e.bigClusterLabel||"N/A"}
      </div>
      <div style="margin-bottom: 0.3em;">
        <strong>Region:</strong> ${e.region||"N/A"}
      </div>
      <div>
        <strong>Size:</strong> ${e.bubbleSize||"N/A"}
      </div>
    </div>`:x(t)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=voronoi-treemap.min.js.map
